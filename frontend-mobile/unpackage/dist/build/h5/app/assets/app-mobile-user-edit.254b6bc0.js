import{_ as t,P as e,u as a,a as o,o as l,c as n,b as i,p as s,d as r,q as c,r as d,l as u,s as w,v as p,h as m,x as f,y as g,w as h,f as b}from"./index-737b53c3.js";import{S as v,r as y}from"./uni-popup.5b1a2d94.js";import{I}from"./IconFont.01846b5a.js";import{T as x,a as V,_ as U}from"./uni-file-picker.6ceede09.js";import{L as T}from"./loginModal.67ba5289.js";import{B as _}from"./BannerView.e3e5622f.js";import"./uni-easyinput.5ef0cfe0.js";import"./iconify.5a6252cb.js";const k=t({components:{SPIcon:v,IconFont:I,TextInput:x,TextareaInput:V,AvatarUploader:t({components:{SPIcon:v,IconFont:I,TextInput:x,TextareaInput:V,LoginModal:T},props:{modelValue:"",defaultValue:e.DEFAULT_ACCOUNT_AVATAR},data:()=>({}),computed:{accountId:()=>a().$state.accountId},async created(){},methods:{triggerUpload(){this.accountId?this.$refs.uploader.choose():this.$refs.LoginModal.show()},getPreviewStyle(){return{background:`url(${this.modelValue||this.defaultValue}) no-repeat center center`,"background-size":"cover"}},async upload(t){const e=null==t?void 0:t.tempFilePaths;if(!e||!e.length)return;const a=e[0],l=await o.UploadImage(a),n=(null==l?void 0:l.image_uri)||"";n&&this.$emit("update:modelValue",n)}}},[["render",function(t,e,a,o,u,w){const p=y(c("uni-file-picker"),U),m=d("LoginModal");return l(),n("div",{class:"tw-flex tw-flex-col tw-items-center tw-justify-center"},[i("div",{onClick:e[0]||(e[0]=(...t)=>w.triggerUpload&&w.triggerUpload(...t)),class:"tw-relative tw-w-28 tw-h-28 tw-rounded-full tw-overflow-hidden"},[i("div",{class:"tw-absolute tw-t-0 tw-l-0 tw-bg-white tw-bg-opacity-10 tw-w-full tw-h-full",style:s(w.getPreviewStyle())},null,4),i("div",{class:"tw-transition tw-duration-300 tw-cursor-pointer tw-flex tw-items-center hover:tw-bg-opacity-50 tw-justify-center tw-absolute tw-t-0 tw-l-0 tw-bg-black tw-bg-opacity-30 tw-w-full tw-h-full"},[i("img",{class:"tw-w-6 tw-h-6",src:"https://static.xxxxxx.com/627400846e6019a4819cb30ff5279e4653e074b272a8a8f1f68dd1e37212c76f",alt:""})])]),i("div",{class:"tw-text-white tw-text-opacity-30 tw-mt-3 tw-text-base"},"点击修改头像"),i("div",{style:{display:"none"}},[r(p,{ref:"uploader",sourceType:["album"],onSelect:w.upload,"del-icon":!1,"file-mediatype":"image",limit:"1","disable-preview":!0},null,8,["onSelect"])]),r(m,{ref:"LoginModal"},null,512)])}],["__scopeId","data-v-c531afa8"]]),BannerUploader:t({components:{SPIcon:v,IconFont:I,TextInput:x,TextareaInput:V,LoginModal:T,BannerView:_},props:{modelValue:"",defaultValue:e.DEFAULT_ACCOUNT_AVATAR},data:()=>({}),computed:{accountId:()=>a().$state.accountId},async created(){},methods:{triggerUpload(){this.accountId?this.$refs.uploader.choose():this.$refs.LoginModal.show()},getImage(){return this.modelValue||this.defaultValue},async upload(t){const e=null==t?void 0:t.tempFilePaths;if(!e||!e.length)return;const a=e[0],l=await o.UploadImage(a),n=(null==l?void 0:l.image_uri)||"";n&&this.$emit("update:modelValue",n)}}},[["render",function(t,e,a,o,s,u){const w=d("BannerView"),p=y(c("uni-file-picker"),U),m=d("LoginModal");return l(),n("div",{class:"tw-relative"},[i("div",{onClick:e[0]||(e[0]=(...t)=>u.triggerUpload&&u.triggerUpload(...t)),class:"tw-z-[1] tw-text-white tw-text-center tw-bg-black tw-border tw-border-solid tw-border-white tw-bg-opacity-10 tw-border-opacity-30 tw-px-3 tw-py-1 tw-rounded tw-absolute tw-right-3 tw-top-3 tw-text-sm"}," 点击设置背景图 "),r(w,{value:u.getImage()},null,8,["value"]),i("div",{style:{display:"none"}},[r(p,{ref:"uploader",sourceType:["album"],onSelect:u.upload,"del-icon":!1,"file-mediatype":"image",limit:"1","disable-preview":!0},null,8,["onSelect"])]),r(m,{ref:"LoginModal"},null,512)])}],["__scopeId","data-v-83e35d4c"]])},data:()=>({config:{avatar:"",name:"",description:"",banner:""}}),computed:{accountId:()=>a().$state.accountId},async onShow(){this.accountId?await this.loadMe():u({url:"/app/mobile/login"})},async created(){},methods:{getAvatarImageStyle(){return{background:`url(${this.config.avatar||e.DEFAULT_ACCOUNT_AVATAR}) no-repeat center center`,"background-size":"cover"}},async save(){await o.UpdateAccountProfile({avatar:this.config.avatar,name:this.config.name,desc:this.config.description,banner:this.config.banner}),this.back()},back(){w({url:"/app/mobile/user/me"})},async loadMe(){let t;p({title:"加载中",mask:!0});try{t=await o.Me(!0)}finally{this.config={avatar:t.avatar||m(),name:t.name||"",description:t.desc||"",banner:t.banner||f()},g()}},async bannerUpload(t){const e=null==t?void 0:t.tempFilePaths;if(!e||!e.length)return;const a=e[0],l=await o.UploadImage(a),n=(null==l?void 0:l.image_uri)||"";n&&(this.config.banner=n)},async avatarUpload(t){const e=null==t?void 0:t.tempFilePaths;if(!e||!e.length)return;const a=e[0],l=await o.UploadImage(a),n=(null==l?void 0:l.image_uri)||"";n&&(this.config.avatar=n)}}},[["render",function(t,e,a,o,s,c){const u=d("BannerUploader"),w=d("AvatarUploader"),p=d("TextInput"),m=d("TextareaInput"),f=b;return l(),n("div",{class:"bg-page tw-h-full tw-text-white tw-text-opacity-80 tw-overflow-hidden tw-text-left"},[r(u,{modelValue:s.config.banner,"onUpdate:modelValue":e[0]||(e[0]=t=>s.config.banner=t)},null,8,["modelValue"]),i("div",{class:"overflow-x-auto tw-overflow-y-hidden tw-pb-5 tw-px-5 -tw-mt-16"},[r(w,{modelValue:s.config.avatar,"onUpdate:modelValue":e[1]||(e[1]=t=>s.config.avatar=t)},null,8,["modelValue"]),i("div",{class:"tw-mt-8"},[i("div",{class:"tw-mt-2"},[r(p,{modelValue:s.config.name,"onUpdate:modelValue":e[2]||(e[2]=t=>s.config.name=t),label:"昵称",placeholder:"请输入昵称"},null,8,["modelValue"])]),i("div",{class:"tw-mt-5"},[r(m,{label:"描述",modelValue:s.config.description,"onUpdate:modelValue":e[3]||(e[3]=t=>s.config.description=t),placeholder:"请输入描述"},null,8,["modelValue"])])]),i("div",{class:"tw-mt-6 tw-grid tw-grid-cols-2 tw-gap-8"},[r(f,{onClick:c.back,class:"tw-w-full tw-rounded-xl tw-bg-white tw-bg-opacity-5 hover:tw-bg-opacity-10 tw-transition"},{default:h((()=>[i("div",{class:"tw-text-white tw-text-base tw-flex tw-items-center tw-justify-center tw-py-3.5"},[i("img",{class:"tw-w-5 tw-h-5 tw-mr-2",src:"https://static.xxxxxx.com/mdi/af8ebf95055ff7a71f265a8bcaad2eec569d30d0eabe56239b03602f7da20e76"}),i("span",null,"返回")])])),_:1},8,["onClick"]),r(f,{onClick:c.save,"hover-class":"none",class:"tw-w-full tw-rounded-xl tw-bg-white tw-bg-opacity-5 hover:tw-bg-opacity-10 tw-transition"},{default:h((()=>[i("div",{class:"tw-text-white tw-text-base tw-flex tw-items-center tw-justify-center tw-py-3.5"},[i("img",{class:"tw-w-5 tw-h-5 tw-mr-2",src:"https://static.xxxxxx.com/d2545c1e3cc1982dbc11b3aca8bde1cf2b39b4fa443782336a621ad0a80aaed2"}),i("span",null,"保存")])])),_:1},8,["onClick"])])])])}],["__scopeId","data-v-046df1f8"]]);export{k as default};
